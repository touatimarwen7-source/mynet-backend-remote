خطة العمل التفصيلية لمنصة MyNet.tn
سنقوم بتقسيم الخطة إلى أربع مراحل رئيسية.
المرحلة الأولى: بناء الأساسيات والأمن (MVP) - (الأولوية القصوى)
الأولوية	القسم	الخطوة	الوصف التنفيذي (Backend Focus)	الهيكل المعماري المُتأثر	ملاحظات معمارية (Clean Architecture)
عاجل	1. الإعداد الأساسي	1.3	نماذج البيانات: تصميم النماذج الأساسية (User.ts, Tender.ts, Offer.ts). يجب أن يتضمن Offer.ts حقلاً لـ encrypted_data وحقل decryption_key_id.	backend/models/	النماذج هي "لغة المجال (Domain Language)". نستخدم Tender.ts كنموذج كتابة أساسي (Command Model).
أول	2. الأمن والمصادقة	2.1	المصادقة: تنفيذ authController.ts لـ JWT. تنفيذ authMiddleware.ts للتحقق من صحة التوكن و roleMiddleware.ts لفرض أدوار (Buyer, Supplier).	backend/controllers/, backend/middleware/	Authentication vs. Authorization: authMiddleware يثبت الهوية (من أنت). roleMiddleware يحدد الحد الأدنى للدخول (هل أنت مشتري أو مورد).
أول	2. الأمن والمصادقة	2.2	إدارة المفاتيح: تنفيذ KeyManagementService.ts لإنشاء وتخزين مفاتيح التشفير بشكل آمن (عادةً يتم استخدام مفاتيح لكل مناقصة أو عرض).	backend/security/, backend/utils/	السرية (Secrecy): هذا الفصل يضمن أن مفاتيح التشفير/فك التشفير يتم التعامل معها في طبقة منفصلة، لا يمكن للـ OfferService الوصول إليها مباشرة.
أول	2. الأمن والمصادقة	2.3	تشفير العروض: تحديث OfferService.ts لتضمين منطق التشفير باستخدام KeyManagementService قبل حفظ البيانات في قاعدة البيانات.	backend/services/, models/Offer.ts	النموذج الأمني: يجب أن يكون فك التشفير متاحًا فقط في نقطة محددة جدًا في TenderService (بعد تاريخ فتح المظاريف).
ثان	3. دورة المناقصة	3.1	نشر المناقصة: تنفيذ TenderService.ts لإنشاء المناقصة. يجب التحقق من هوية المستخدم (Buyer).	backend/services/	منطق الخدمة: يجب أن يتأكد الـ TenderService من أن TenderCreateDto سليم قبل البدء بالعملية.
ثان	3. دورة المناقصة	3.2	تقديم العرض: تنفيذ OfferController.ts. يجب أن يستقبل OfferSubmitDto، ويستدعي OfferService.submitEncrypted().	backend/controllers/procurement/, backend/mappers/dtos/	فصل DTO: استخدام OfferSubmitDto يضمن أن جسم الطلب لا يحتوي على أي حقول زائدة أو مفقودة قبل دخوله إلى الـ Service.
________________________________________
المرحلة الثانية: العمليات التجارية والمالية
الأولوية	القسم	الخطوة	الوصف التنفيذي (Backend Focus)	الهيكل المعماري المُتأثر	ملاحظات معمارية (Clean Architecture)
أول	4. إتمام المعاملات	4.1	الترسية وأمر الشراء: تحديث TenderService.ts لوظيفة الترسية (فك التشفير هنا). إنشاء PurchaseOrderService.ts لتوليد PO تلقائيًا.	backend/services/, models/PurchaseOrder.ts	تسلسل العمليات: يجب أن تتضمن خدمة الترسية خطوة التحقق عبر TenderPolicy.ts (هل المشتري لديه الصلاحية للترسية؟) قبل إصدار PO.
أول	5. إدارة النظام	5.2	بوابة الدفع (Webhooks): تنفيذ PaymentWebhookController.ts و WebhookSecretValidator.ts. يجب استخدام QueueService لمعالجة تحديثات الباقات غير المتزامنة.		
 
Shutterstock
| backend/controllers/webhooks/, backend/security/, backend/queues/ | معالجة غير متزامنة: Webhook يجب أن يرد فورًا بـ 200 OK ثم يحول المعالجة الثقيلة (تحديث باقة الاشتراك) إلى الـ QueueService. | | ثان | 4. إتمام المعاملات | 4.3 | سجل التدقيق (Audit Log): إعداد QueueService لتسجيل جميع التغييرات الحساسة (Audit Events) في جدول منفصل. | backend/queues/, models/TenderHistory.ts | الأمن والامتثال: يفصل تسجيل التدقيق عن مسار HTTP الأساسي، مما يضمن عدم تأثير عملية التسجيل على سرعة استجابة المستخدم. | | ثان | 5. إدارة النظام | 5.1 | الاشتراكات: تنفيذ SubscriptionPlan.ts و SubscriptionService.ts. تحديث User.ts لربطه بالباقة الحالية. | backend/services/, models/ | Authorization by Subscription: يجب أن يتحقق AuthorizationGuard من أن الباقة تسمح بهذه الميزة (مثلاً: الباقة المجانية لا تسمح بأكثر من 5 مناقصات). | | ثان | 5. إدارة النظام | 5.3 | لوحة المدير: تنفيذ AdminController.ts الأساسي (إدارة المستخدمين والباقات). يجب استخدام roleMiddleware لفرض دور ADMIN. | backend/controllers/admin/, backend/routes/adminRoutes.ts | أقل امتياز: يجب أن يكون AdminController هو الوحيد الذي لديه إذن كتابة/تعديل على SubscriptionPlan.ts و UserManagementService. |
________________________________________
المرحلة الثالثة: المرونة والذكاء
الأولوية	القسم	الخطوة	الوصف التنفيذي (Backend Focus)	الهيكل المعماري المُتأثر	ملاحظات معمارية (Clean Architecture)
أول	6. مرونة الشراء	6.1	الشراء المباشر: تنفيذ PurchaseRequestService.ts لوظيفة الطلب المباشر. يجب أن يتكامل مع AuthorizationGuard لضمان دعوة مورد واحد فقط.	backend/services/, models/PurchaseRequest.ts	مرونة الأعمال: هذه خدمة منفصلة تمامًا عن دورة المناقصة التقليدية، مما يسهل صيانتها وتطويرها بشكل مستقل.
أول	7. الذكاء الآلي	7.1	محرك مقارنة العروض: تنفيذ OfferComparisonEngine.ts كخدمة مستقلة. يتم استدعاؤها من TenderService بعد فك التشفير.	backend/reporting/	فصل الاهتمامات (Separation of Concerns): فصل منطق التحليل عن منطق إدارة المناقصة. هذا الكود يجب أن يكون نقيًا (Pure Logic).
ثان	6. مرونة الشراء	6.2	نظام التقييم: تنفيذ ReviewService.ts. يجب أن يحتوي على منطق يمنع التقييم قبل أن تكون حالة PurchaseOrder.ts هي "Completed".	backend/services/, models/Review.ts	التحقق من المجال (Domain Validation): يتم تطبيق قاعدة "التقييم بعد الإنجاز" داخل الـ Service، وليس في الـ Controller.
ثان	7. الذكاء الآلي	7.2	التنبيهات الذكية: تحديث NotificationService.ts ليستخدم SearchService (لتحديد المناقصات ذات الصلة) و UserProfile (لتحديد تفضيلات المستخدم).	backend/messaging/, backend/services/	التخصيص: يستخدم المنطق المعقد لتحديد أولويات الإشعارات (Smart Notifications) بدلاً من إرسال إشعارات عامة.
ثالث	6. مرونة الشراء	6.3	خدمة التواصل: تنفيذ ChatService.ts (بواسطة WebSockets). يجب أن يكون الوصول الموثق مقيدًا على مستوى PurchaseOrder.ts (فقط بعد الترسية).	backend/realtime/	Realtime Logic: يجب أن يتمتع باتصال آمن، حيث يتم تمرير رمز JWT للتحقق من هوية المتصلين قبل السماح لهم بالانضمام إلى غرفة الدردشة الخاصة بـ PO محدد.
Exporter vers Sheets
________________________________________
المرحلة الرابعة: التحصين والإنتاج (الانتهاء والتسليم)
الأولوية	القسم	الخطوة	الوصف التنفيذي (Backend Focus)	الهيكل المعماري المُتأثر	ملاحظات معمارية (Clean Architecture)
أول	8. التحسينات	8.5	تحسين الأداء (CQRS): إنشاء TenderReadView.ts وملء هذا النموذج عبر QueueService بعد كل عملية كتابة ناجحة (ترسية/تحديث).	models/, backend/queues/	CQRS Optimization: فصل قاعدة بيانات القراءة عن الكتابة. قراءة قائمة المناقصات لن تضطر إلى انتظار اكتمال عمليات الكتابة المعقدة.
أول	8. التحسينات	8.4	تحصين DTOs: تطبيق التحقق من صحة المدخلات والمخرجات (DTOs) على جميع الـ Controllers المتبقية (بما في ذلك مسارات المدير).	backend/mappers/dtos/	آخر خط دفاع: ضمان سلامة البيانات في كل نقطة اتصال خارجية (بين الواجهة الأمامية والخلفية).
ثان	8. التحسينات	8.3	التكامل الخارجي: تنفيذ ERPService.ts و AccountingAdapter.ts. استخدام QueueService لتنفيذ هذه المهام بشكل غير متزامن.	backend/integrations/, backend/services/	Adapter Pattern: يمنع ربط منطق الأعمال الخاص بك بواجهة API الخاصة بنظام خارجي. إذا تغير النظام الخارجي، نعدل الـ Adapter فقط.
ثان	8. التحسينات	8.1	الترسية الجزئية: تعديل منطق TenderService و PurchaseOrderService للسماح بتقسيم المناقصة على عدة موردين (إنشاء أوامر شراء متعددة).	backend/services/	منطق تجاري معقد: هذا يتطلب منطقًا إضافيًا لربط النسبة المئوية للترسية بكل PO جديد.
ثالث	8. التحسينات	8.2	الأرشفة والامتثال: تنفيذ ArchivingService.ts لجدولة مهام نقل الوثائق القديمة. يجب أن تُشغل هذه المهام عبر QueueService ليلاً أو في أوقات انخفاض الضغط.	backend/services/, backend/queues/	الامتثال والأداء: الحفاظ على قاعدة البيانات التشغيلية (Neon) صغيرة وسريعة عن طريق نقل البيانات القديمة إلى تخزين أرخص.

